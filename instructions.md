# Data Engineer technical test

For the purpose of this exercise we have supplied a SQLite 3 database file, "sqlite.db", which
contain`s a sample of data from a Redshift cluster. Your solutions should be based on the the sample
data set in the SQLite database but also consider the implications of dealing with the much
larger data set in the cluster.


## Database schema

The SQLite 3 database file contains the following six tables:

### send_event

| Column     | Type    | Notes                                   |
| ---------- | ------- | --------------------------------------- |
| batch_id   | INTEGER |                                         |
| to_email   | TEXT    |                                         |
| sent_date  | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |
| successful | INTEGER |                                         |

### open_event

| Column     | Type    | Notes                                   |
| ---------- | ------- | --------------------------------------- |
| batch_id   | INTEGER |                                         |
| to_email   | TEXT    |                                         |
| open_date  | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |
| ip_address | TEXT    |                                         |
| user_agent | TEXT    |                                         |

### bounce_event

| Column      | Type    | Notes                                   |
| ----------- | ------- | --------------------------------------- |
| batch_id    | INTEGER |                                         |
| to_email    | TEXT    |                                         |
| bounce_date | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |

### click_event

| Column     | Type    | Notes                                   |
| ---------- | ------- | --------------------------------------- |
| batch_id   | INTEGER |                                         |
| to_email   | TEXT    |                                         |
| click_date | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |
| ip_address | TEXT    |                                         |
| user_agent | TEXT    |                                         |
| url        | TEXT    |                                         |

### unsub_event

| Column     | Type    | Notes                                   |
| ---------- | ------- | --------------------------------------- |
| email      | TEXT    |                                         |
| unsub_date | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |
| ip_address | TEXT    |                                         |
| user_agent | TEXT    |                                         |

### event_summary

| Column      | Type    | Notes                                   |
| ----------- | ------- | --------------------------------------- |
| batch_id    | INTEGER |                                         |
| to_email    | TEXT    |                                         |
| sent_date   | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |
| bounce_date | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |
| open_date   | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |
| click_date  | TEXT    | Timestamp in YYYY-mm-dd HH:MM:SS format |

## Background

With the exception of `event_summary`, each table contains data about a specific type of event in
an email marketing campaign, recorded by the system that sends the emails and tracks responses.
The process flow of the email marketing campaign starts with a batch send to many email addresses.
The batch is identified by a common `batch_id` number which is shared across all email addresses
that were sent to in the single batch. All recipients receive similar content in the email body,
although it may be slightly customised for each recipient. Each send to each individual email
address is recorded in `send_event`.

Some of the emails may later generate a "bounce" response if the email cannot be delivered - for
example if the email address does not exist. These are recorded in `bounce_event`.

The emails have embedded image tags which point to a unique URL on the email service provider's
servers, so whenever the recipient opens an email and their email client attempts to load the image
an event is recorded in `open_event`. This can only be recorded if the user has their email client
set to automatically load and display images.

There are links in the email body which point to URLs on the email service provider's servers, so
that when a recipient clicks on one of the links, they are brought to a tracking page which records
that they have clicked on the link in `click_event` and then redirects them to the intended
destination.

The `event_summary` table contains a summary of when each type of event was triggered for each
recipient email address in the batch. It has been generated by starting with `send_event` and doing
a simple (left outer) join to the other `_event` tables to find the timestamps of the other events
if they occurred.

## The task

The task is split into the two parts detailed below. These can be done in SQL, or a combination of
SQL and another programming language e.g. Python or Java (other languages are OK as well, as long
as you can explain how the code works and how to run it).

### Part A

An analyst looking at the email marketing campaign data has reported finding multiple records in
the `event_summary` table for some recipient emails. Identify the probable cause of these
duplicates, and suggest and implement a fix. This may require new tables or changes to the existing
one.

### Part B

Since the `event_summary` table was last updated, new open and click events have been logged in the
other `_event` tables. Implement some code to update the `event_summary` table to take in to
account new open and click events, which can be run repeatedly to update `event_summary` as new
events are logged over time.

### Extra feature

There is another table `unsub_event` which records whenever a recipient unsubscribes from marketing
emails. Assume that if someone unsubscribes within 2 days of being sent a marketing email, that
specific email can be considered as the cause of them unsubscribing. Given that assumption, add to
the summary a new field showing, for each batch send and each recipient, if and when the recipient
unsubscribed as a result of being sent the email.

## What to submit as a response

Please provide the source code that can be run to complete the tasks along with instructions for
building (if applicable) and running it. You don't need to provide the generated summary data, just
your code to generate the data from the database file supplied. Please also provide notes
explaining any design or implementation choices and reasoning behind them.

You can submit the response as file(s) in a Zip file or as a source code repository that we can
access (e.g. Github or Bitbucket).

Thanks!
